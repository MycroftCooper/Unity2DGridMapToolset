### **迷宫生成器的总体逻辑**

迷宫生成过程分为三个阶段：

1. 第一阶段：生成有效路径

   （控制参数：C）

   - 确保从起点到终点存在一条有效路径，且路径的复杂程度受 `C` 参数控制。

2. 第二阶段：填充剩余迷宫

   （控制参数：B）

   - 使用经典的迷宫生成算法填充其他区域，控制分支的数量和密度。

3. 第三阶段：生成环路

   （控制参数：L）

   - 在已有的迷宫基础上，随机打破墙体形成环路，增加迷宫的探索性和复杂性。

------

### **第一阶段：生成有效路径**

**目标**：从起点到终点生成一条连通的有效路径，并通过 `C` 参数控制路径的直线性或曲折性。

1. **初始化迷宫**

   - 地图初始化为全封闭状态，所有节点被墙隔开。

2. **随机深度优先搜索（Random DFS）生成路径**

   - 从起点出发，随机选择方向扩展路径，移除墙体直到到达终点。

   - 根据 C

      参数动态调整随机性：

     - `C = 0`：优先选择朝向终点的方向，生成近乎直线的路径。
     - `C = 1`：随机性最大，路径更曲折。

3. **标记路径节点**

   - 将生成的有效路径上的节点和墙体标记为“保护区域”，避免后续修改。

------

### **第二阶段：填充剩余迷宫**

**目标**：填充除主路径外的迷宫区域，控制分支的数量和密度，形成完整的迷宫结构。

1. **选择经典迷宫生成算法**
   - 推荐算法：
     - **随机深度优先搜索（Random DFS）**：生成较长的分支路径，适合分支数量较少的迷宫。
     - **Prim算法**：生成较多分支路径，适合分支数量较多的迷宫。
     - **Kruskal算法**：基于边的操作，适合更灵活的迷宫结构。
2. **控制分支密度（`B` 参数）**
   - `B = 0`：生成最少的分支，迷宫接近树形结构。
   - `B = 1`：生成大量分支，迷宫更具探索性。
3. **避免干扰主路径**
   - 填充时跳过已标记的主路径节点和墙体，确保主路径的完整性。

------

### **第三阶段：生成环路**

**目标**：通过打破部分墙体在迷宫中生成环路，增强探索性和复杂性。

1. **选择环路生成方法**
   - 随机墙体移除法：
     - 遍历所有墙体，检查是否可以移除。
     - 根据 `L` 参数的概率决定是否移除墙体，生成环路。
   - 随机边集扩展法：
     - 将迷宫视为图，增加额外边（移除墙体）形成环路。
     - 更精确地控制环路数量和分布。
2. **控制环路密度（`L` 参数）**
   - `L = 0`：完全无环路，迷宫保持树形结构。
   - `L = 1`：环路密集，迷宫接近网格图。
3. **优化环路分布**
   - 避免环路集中在某一区域，通过分区生成或动态调整概率实现均匀分布。
4. **保护主路径**
   - 避免移除主路径的墙体，确保主路径的辨识度和连通性。

------

### **整体参数的控制与平衡**

| **参数** | **作用**                   | **范围** | **影响**                                         |
| -------- | -------------------------- | -------- | ------------------------------------------------ |
| `C`      | 控制起点到终点路径的复杂性 | `[0, 1]` | 越大路径越曲折，探索感更强                       |
| `B`      | 控制分支的数量和密度       | `[0, 1]` | 越大分支越多，迷宫的选择路径更多                 |
| `L`      | 控制环路的数量和分布       | `[0, 1]` | 越大环路越多，迷宫更复杂，但主路径辨识度可能降低 |

------

### 